/*
========================================================================================
    Config file for defining DSL2 per module options
========================================================================================
    Available keys to override module options:
        args            = Additional arguments appended to command in module.
        args2           = Second set of arguments appended to command in module (multi-tool modules).
        args3           = Third set of arguments appended to command in module (multi-tool modules).
        publish_dir     = Directory to publish results.
        publish_by_meta = Groovy list of keys available in meta map to append as directories to "publish_dir" path
                            If publish_by_meta = true                 - Value of ${meta['id']} is appended as a directory to "publish_dir" path
                            If publish_by_meta = ['id', 'custompath'] - If "id" is in meta map and "custompath" isn't then "${meta['id']}/custompath/"
                                                                        is appended as a directory to "publish_dir" path
                            If publish_by_meta = false / null         - No directories are appended to "publish_dir" path
        publish_files   = Groovy map where key = "file_ext" and value = "directory" to publish results for that file extension
                            The value of "directory" is appended to the standard "publish_dir" path as defined above.
                            If publish_files = null (unspecified)     - All files are published.
                            If publish_files = false                  - No files are published.
        suffix          = File name suffix for output files.
----------------------------------------------------------------------------------------
*/

params {
    modules {
        'checksums'{
            publish_dir  = 'checksums'
        }
        'fastqc' {
            args         = '--quiet'
        }
        'multiqc' {
            args         = ''
        }
        'cutadapt' {
            args         = "-Z -e 0 --no-indels --action none --discard-untrimmed -g ${params.restriction_sites}"
            publish_dir  = 'trimmed_fq'
        }
        //preparegenome.nf
        'digest_genome'{
            publish_dir  = 'genome/digest'
        }
        'genomefilter'{
            publish_dir  = 'genome/filtered'
        }
        'chromsizes'{
            publish_dir  = 'genome'
        }
        'bwa_index' {
            args         = '-a bwtsw'
            publish_dir  = 'genome/bwa_index'
        }
        'gtf2bed' {
            publish_files= ''
        }
        'gffread' {
            publish_files= ''
        }
        'gunzip' {
            publish_files=''
        }
        'bwa_mem' {//not output, need to be merged and sorted
            args         = '-SP' //skip mate rescue and pairing
            publish_files= ''
        }
        'samtools_merge' {//not output, output when bam_stats
            publish_files= ''
        }
        //bam_stats.nf
        'samtools_sort' {//bam_stats, start from sorting
            suffix       = '.srt'
            publish_dir  = 'bwa/mapped/bam'
        }
        'samtools_index' {
            publish_dir  = 'bwa/mapped/bam'
        }
        'samtools_stats' {//bam_stats
            publish_dir  = 'bwa/mapped/QC'
        }
        'samtools_flagstat' {//bam_stats
            publish_dir  = 'bwa/mapped/QC'
        }
        'samtools_idxstats' {//bam_stats
            publish_dir  = 'bwa/mapped/QC'
        }
        //pairtools.nf
        'pairtools_parse' {
            args         = '--min-mapq 10 --max-molecule-size 2000 --max-inter-align-gap 20 --walks-policy mask  --no-flip --drop-seq --drop-sam'
            publish_dir  = 'pairs/raw'
        }
        'pairtools_flip' {
            publish_files= ''
        }
        'pairtools_select'{// select valid pairs
            args         = "(pair_type=='UU') or (pair_type=='UR') or (pair_type=='RU')"
            publish_files= ''
        }
        'pairtools_sort' {// sort the valid pairs
            suffix       = '.sorted'
            publish_files= ''
        }
        'paritools_dedup'{// remove duplicate pairs
            args         = '--max-mismatch 1 --method max'
            suffix       = '.dedup'
            publish_files= ''
        }
        'pairtools_restrict'{//remove same fragment pairs
            suffix       = '.restrict'
            publish_files= ''
        }
        'pairtools_select_long'{//publish valid.pairs
            args         = '(COLS[-6]==COLS[-3]) and (chrom1==chrom2)'
            publish_dir  = 'pairs/filtered/samefrag'
        }
        'pairix'{//index for valid.pairs
            publish_dir  = 'pairs/filtered'
        }
        'reads_stat' {
            publish_dir  = 'pairs/QC'
        }
        'reads_summary'{
            publish_dir  = 'pairs/QC'
        }
        'pairsqc'{
            publish_dir  = 'pairs/QC'
        }
        'pairsplot'{
            publish_dir  = 'pairs/QC'
        }
        //cooler.nf
        'cooler_cload'{
            args         = '--max-split 2'
            publish_files= ''
        }
        'cooler_merge'{
            publish_dir  = 'cooler/merge'
            publish_files= ''
        }
        'cooler_zoomify'{
            publish_dir  = 'cooler/mcool'
        }
        'cooler_dump_per_group'{
            args         = '-t pixels -H --join'
            publish_files= ''
        }
        'cooler_dump_per_sample'{
            args         = '-t pixels -H --join'
            publish_files= ''
        }
        'dumpintrareads_per_group'{// dump long intra reads for each group for maps
            publish_dir  = 'pairs/long_reads/byGroup'
        }
        'dumpintrareads_per_sample'{// dump long intra reads for each samples for differential analysis
            publish_dir  = 'pairs/long_reads/bySample'
        }
        //callatacpeak.nf
        'pairtools_select_short'{// extract ATAC reads, split the pairs into longRange_Trans pairs (unselected) and short pairs (selected)
            args         = '(chrom1==chrom2) and (abs(pos1 - pos2) < 1e4)'
            suffix       = '.short'
            publish_dir  = 'pairs/filtered/short'
        }
        'shift_reads'{// shift Tn5 insertion for longRange_Trans pairs
            publish_dir  = 'ATACpeak/shifted_R2_reads'
        }
        'merge_reads'{// merge the read in same group
            publish_dir  = 'ATACpeak/merged_R2_reads'
        }
        'macs2_atac'{// call ATAC narrow peaks for group
            args         = "--shift ${params.shiftsize} --extsize ${params.smooth_window} --nomodel -B --SPMR --keep-dup all --call-summits --qval ${params.qval_thresh}"
            publish_dir  = 'ATACpeak/peaks_per_Group'
        }
        'merge_peak'{// merge all the called peaks
            publish_dir  = 'ATACpeak/merged_peaks'
        }
        'dump_reads_per_group'{// dump ATAC reads for each group for maps
            publish_dir  = 'pairs/short_reads/byGroup'
        }
        'dump_reads_per_sample'{// dump ATAC reads for each samples for differential analysis
            publish_dir  = 'pairs/short_reads/bySample'
        }
        // prepare background, multienzyme.nf
        'maps_cut' {
            publish_files= ''
        }
        'maps_fend' {//fix end, by bedtools slop, here are fixed -l 0 -r fragment size;
            args         = '-s -l 0' // parameters for bedtools/slop, please do not modify.
            publish_files= ''
        }
        'genmap_index' {//no publish
            publish_files= ''
        }
        'genmap_mappability' {//no publish
            args         = '-K 50 -E 2 -w'
            publish_files=''
        }
        'ucsc_wigtobigwig' {//publish mappability here
            publish_dir  = 'genome/mappability'
        }
        'ensembl_ucsc_convert'{//no publish
            args         = 'toUCSC'
            publish_files= ''
        }
        'maps_mapability' {
            publish_files= ''
        }
        'maps_merge' {
            publish_files= ''
        }
        'maps_feature'{
            publish_dir  = 'genome/digest'
        }
        //maps_peak.nf
        'maps_maps'{
            args         = '--BINNING_RANGE 100000000'
            args2        = 'NA' //sex_chroms_to_process
            publish_dir  = 'MAPSpeak/parameters'
        }
        'maps_callpeak'{
            args         = "${params.maps_cutoff_counts} ${params.maps_cutoff_fold_change}" // cutoff_counts cutoff_fold_change
            args2        = '' //sex_chroms to be processed
            args3        = 'pospoisson' //model
            publish_dir  = 'MAPSpeak'
        }
        'maps_reformat'{
            publish_dir  = 'MAPSpeak'
        }
        //diffhicar
        'diffhicar'{
            publish_dir  = 'DifferentialAnalyis'
        }
        'chippeakanno'{
            publish_dir  = 'DifferentialAnalyis'
        }
        'enrichment'{
            publish_dir  = 'DifferentialAnalyis'
        }
    }
}
